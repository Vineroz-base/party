<!DOCTYPE html>
<html>
  <head>
    <title>Random Number</title>
    <style>
      body {
        background-color: #121212;
        color: #f5f5f5;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
      }
      .number {
        font-size: 36vw;
      }
      .message {
        font-size: 4vw;
        font-style: italic;
        margin-top: 10px;
        color: #ffcc00;
        text-align: center;
      }
      .button {
        margin-top: 30px;
        padding: 15px 30px;
        font-size: 6vw;
        font-weight: bold;
        color: #121212;
        background-color: #ffcc00;
        border: none;
        border-radius: 10px;
        cursor: pointer;
      }
      .button:hover {
        background-color: #ffaa00;
      }
    </style>
  </head>
  <body>
    <div class="number" id="number"></div>
    <div class="message" id="message"></div>
    <button class="button" onclick="window.location.href='card.html'">
      Go to Card Draw
    </button>

    <script>
      const STORAGE_KEY_NUM = "randomNumber";
      const STORAGE_KEY_TIME = "randomNumberTime";
      const DURATION = 30 * 60 * 1000; // 30 minutes
      const SHEET_ID = "12o5s8jnBuk-Phw17DEoMGPsXMOY1v65cmdkYasS9g9U"; // your sheet ID
      const API_KEY = "AIzaSyDJuS2F8KArnLa7Fd66h4mx7hesbuJNZyU"; // replace with your Google Cloud API key

      const now = Date.now();
      let number, timestamp;

      const storedNumber = localStorage.getItem(STORAGE_KEY_NUM);
      const storedTime = localStorage.getItem(STORAGE_KEY_TIME);

      if (storedNumber && storedTime && (now - storedTime < DURATION)) {
        number = parseInt(storedNumber, 10);
        timestamp = parseInt(storedTime, 10);
      } else {
        number = Math.floor(Math.random() * 100) + 1;
        timestamp = now;
        localStorage.setItem(STORAGE_KEY_NUM, number);
        localStorage.setItem(STORAGE_KEY_TIME, timestamp);

        // ðŸ”— Send result to Google Sheets
        sendResult(number, timestamp);
      }

      document.getElementById("number").textContent = number;

      function updateCountdown() {
        const remaining = (timestamp + DURATION) - Date.now();

        if (remaining <= 0) {
          document.getElementById("message").textContent =
            "Expired â€” refresh for a new number!";
          return;
        }

        const minutes = Math.floor(remaining / 60000);
        const seconds = Math.floor((remaining % 60000) / 1000);

        const mm = minutes.toString().padStart(2, "0");
        const ss = seconds.toString().padStart(2, "0");

        document.getElementById("message").textContent = `${mm}:${ss}`;
      }

      updateCountdown();
      setInterval(updateCountdown, 1000);

      // âœ… Implementation of sendResult
      function sendResult(num, time) {
        fetch(
          `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1!A:B:append?valueInputOption=RAW&key=${API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              values: [[num, new Date(time).toISOString()]]
            })
          }
        )
          .then(res => res.json())
          .then(data => console.log("Saved to Google Sheets:", data))
          .catch(err => console.error("Error saving:", err));
      }
    </script>
  </body>
</html>
